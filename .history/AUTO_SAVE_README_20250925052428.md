# Hướng dẫn tính năng Auto-Save (Tự động lưu dữ liệu thời tiết)

## Tổng quan
Ứng dụng thời tiết đã được nâng cấp với tính năng **tự động lưu dữ liệu thời tiết** vào database theo lịch trình định sẵn, giúp xây dựng lịch sử thời tiết một cách tự động và liên tục.

## Tính năng Auto-Save

### 🕐 Tần suất lưu dữ liệu
- **Mỗi 6 giờ**: Dữ liệu thời tiết được tự động lưu vào database
- **4 lần/ngày**: Đảm bảo có đủ dữ liệu để phân tích xu hướng
- **Tự động**: Không cần can thiệp thủ công từ người dùng

### 🔍 Điều kiện lưu dữ liệu
1. **Có dữ liệu thời tiết hiện tại**: Ứng dụng phải đang hiển thị thông tin thời tiết
2. **Có địa điểm được chọn**: Phải có địa điểm cụ thể để lưu dữ liệu
3. **Chưa lưu trong 6 giờ qua**: Tránh lưu trùng lặp dữ liệu

### 📊 Dữ liệu được lưu tự động
- **Địa điểm**: Tên địa điểm hiện tại
- **Tọa độ**: Vĩ độ và kinh độ
- **Nhiệt độ**: Nhiệt độ hiện tại và cảm giác
- **Độ ẩm**: Phần trăm độ ẩm
- **Áp suất**: Áp suất khí quyển
- **Gió**: Tốc độ và hướng gió
- **Tầm nhìn**: Khoảng cách tầm nhìn
- **Mô tả thời tiết**: Trạng thái thời tiết (nắng, mưa, v.v.)
- **Icon thời tiết**: Biểu tượng thời tiết
- **Đơn vị**: Celsius hoặc Fahrenheit
- **Thời gian**: Thời điểm lưu dữ liệu

## Giao diện Auto-Save

### 🟢 Trạng thái hiển thị
- **"Auto-save: Bật"**: Timer đang hoạt động
- **"Đã lưu: HH:mm"**: Thời gian lưu dữ liệu gần nhất
- **"Lỗi lưu dữ liệu"**: Có lỗi xảy ra khi lưu (màu đỏ)

### 📍 Vị trí hiển thị
- **Tab "Lịch sử thời tiết"**: Góc phải trên cùng
- **Màu xanh**: Trạng thái bình thường
- **Màu đỏ**: Có lỗi xảy ra

## Cách hoạt động

### 1. Khởi động tự động
- Timer được khởi tạo khi ứng dụng bắt đầu
- Chạy ngầm trong background
- Không ảnh hưởng đến hiệu suất ứng dụng

### 2. Kiểm tra điều kiện
- Mỗi 6 giờ, hệ thống kiểm tra:
  - Có dữ liệu thời tiết không?
  - Có địa điểm được chọn không?
  - Đã lưu dữ liệu trong 6 giờ qua chưa?

### 3. Lưu dữ liệu
- Nếu đủ điều kiện: Tự động lưu vào database
- Cập nhật trạng thái trên giao diện
- Ghi log vào Debug Console

### 4. Cập nhật giao diện
- Tự động cập nhật tab "Lịch sử thời tiết" nếu đang mở
- Hiển thị dữ liệu mới nhất
- Cập nhật biểu đồ nếu cần

## Lợi ích

### 📈 Phân tích xu hướng
- **Dữ liệu liên tục**: 4 điểm dữ liệu/ngày
- **Xu hướng nhiệt độ**: Theo dõi thay đổi theo thời gian
- **Mùa mưa**: Phân tích mùa mưa và khô
- **Biến động**: Phát hiện thay đổi thời tiết bất thường

### 🎯 Tự động hóa
- **Không cần can thiệp**: Tự động lưu dữ liệu
- **Liên tục**: Hoạt động 24/7 khi ứng dụng mở
- **Đáng tin cậy**: Kiểm tra điều kiện trước khi lưu

### 📊 Dữ liệu phong phú
- **Lịch sử dài hạn**: Xây dựng database lịch sử
- **Phân tích sâu**: Đủ dữ liệu để tạo biểu đồ
- **So sánh**: So sánh giữa các thời điểm

## Cài đặt kỹ thuật

### ⚙️ Cấu hình Timer
```csharp
// Timer lưu dữ liệu mỗi 6 giờ
autoSaveTimer.Interval = 6 * 60 * 60 * 1000; // 21,600,000 ms
```

### 🔄 Vòng đời Timer
- **Khởi tạo**: Khi ứng dụng bắt đầu
- **Chạy**: Liên tục trong background
- **Dừng**: Khi đóng ứng dụng

### 📝 Logging
- **Debug Console**: Ghi log chi tiết
- **Trạng thái**: Hiển thị trên giao diện
- **Lỗi**: Báo lỗi khi có vấn đề

## Quản lý Auto-Save

### ✅ Kiểm tra trạng thái
- Xem label "Auto-save" trên tab lịch sử
- Màu xanh: Hoạt động bình thường
- Màu đỏ: Có lỗi cần xử lý

### 🔧 Xử lý lỗi
- **Lỗi database**: Kiểm tra kết nối SQL Server
- **Lỗi dữ liệu**: Kiểm tra API thời tiết
- **Lỗi lưu**: Kiểm tra quyền ghi database

### 📊 Theo dõi dữ liệu
- Xem tab "Lịch sử thời tiết"
- Kiểm tra dữ liệu mới nhất
- Phân tích biểu đồ xu hướng

## Lưu ý quan trọng

### ⚠️ Yêu cầu hệ thống
- **Ứng dụng phải mở**: Auto-save chỉ hoạt động khi ứng dụng đang chạy
- **Kết nối internet**: Cần để lấy dữ liệu thời tiết mới
- **SQL Server**: Cần để lưu dữ liệu vào database

### 🔒 Bảo mật
- **Dữ liệu local**: Chỉ lưu trên máy tính cá nhân
- **Không chia sẻ**: Dữ liệu không được gửi đi đâu
- **Riêng tư**: Chỉ người dùng có thể truy cập

### 💾 Dung lượng
- **Kích thước nhỏ**: Mỗi bản ghi ~1KB
- **Tối ưu**: Chỉ lưu dữ liệu cần thiết
- **Dọn dẹp**: Có thể xóa dữ liệu cũ nếu cần

## Mở rộng tương lai

### 🚀 Tính năng nâng cao
- **Cài đặt tần suất**: Cho phép người dùng thay đổi
- **Lưu theo địa điểm**: Lưu dữ liệu cho nhiều địa điểm
- **Xuất dữ liệu**: Xuất lịch sử ra file Excel/CSV
- **Thông báo**: Thông báo khi có dữ liệu mới

### 📱 Tích hợp
- **Windows Service**: Chạy ngầm không cần mở ứng dụng
- **Cloud Sync**: Đồng bộ dữ liệu lên cloud
- **API**: Cung cấp API để truy cập dữ liệu

Tính năng Auto-Save giúp xây dựng một cơ sở dữ liệu thời tiết phong phú và liên tục, tạo nền tảng cho các phân tích và dự báo thời tiết chính xác hơn! 🌤️📊